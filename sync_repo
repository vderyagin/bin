#! /usr/bin/env ruby

=begin

Update specified version control repositories.
Shells out to git(1), hg(1), cvs(1), darcs(1), svn(1), bzr(1) as needed.

Created: 23 Apr 2013
Author: Victor Deryagin <vderyagin@gmail.com>

=end

require 'pathname'

test = ->(subdir, dir) { (dir + subdir).directory? }

if __FILE__ == $PROGRAM_NAME
  if ARGV.empty?
    puts "Usage: #{File.basename(__FILE__)} DIRECTORY..."
    exit
  end

  ARGV.each do |directory|
    Dir.chdir directory do
      command =
        case Pathname.new(File.expand_path(Dir.pwd))
        when test.curry['.bzr']   then ['bzr', 'pull']
        when test.curry['CVS']    then ['cvs', 'update']
        when test.curry['_darcs'] then ['darcs', 'pull']
        when test.curry['.git']   then ['git', 'pull']
        when test.curry['.hg']    then ['hg', 'pull', '-u']
        when test.curry['.svn']   then ['svn', 'update']
        else
          warn "#{directory} is not a valid repository."
          exit 1
        end

      printf "in %s:\n", Dir.pwd
      system(*command)
    end
  end
end
